# 计算机图形学

## 第一节  基本概念

### 色彩视觉

- 什么是色彩？

	- 色彩是对不同波长的光的能量的感知

		- 不同波长的电磁波对应不同的色彩
		- 对于人眼能感知的光（可见光），其波长为380nm到760nm之间
		- “光”是由不同波长的电磁波按照某种能量分布混合叠加而成、

		  -例如“白光”则是由所有可见波长的电磁波以相等的强度混合而成

		- 谱分布：光在各个可见波长的分量的强度分布函数称为光的谱分布。

- RGB色彩空间

	- 在所有用于表示色彩的各种色彩空间中，RGB(红绿蓝)色彩空间在计算机图形学中的使用最为广泛：

		- 色彩使用三通道RGB(r,g,b)来表示；
		- 在RGB色彩空间中，由部分的常用操作可以通过对RGB三通道分别进行处理而进行
		- 通常可以将r,g,b分别规整化为[0,1]内的浮点数；当时用8bit进行存储时，r，g，b通道常取值[0,255]内的整数

	- 色彩被表示为三个基本色彩：红色（R），绿色（R），蓝色（B）的线性组合

		- -C = rR + gG+ bB
		- 为什么选择红绿蓝作为基本色彩？

			- 以人类数据额的三刺激理论为基础；
			- 人眼的视网膜中有三种锥状视觉细胞，分别对红，绿，蓝三种光最敏感。

	- 然而，一部分色彩无法表示成R,G,B光波的正线性组合，这是RGB色彩空间的一个缺点。

- 其他色彩空间

	- CMY

		- 不同于RGB的另外一组基本色彩。青，品红，黄，分别是R,G,B的补色
		- CMY被称为“减色系统”：RGB为“加色系统”--（0,0,0）为黑，（1,1,1）为白  CMY （0,0,0）为白，（1,1,1）为黑

	- HSV色彩空间

		- 圆锥形的色彩空间

			- Hue（色调）也叫色相，它描述了色彩的本征属性，即我们常说的一个色彩是是红，橙，黄，绿，青，蓝，紫，等等。
			- Saturation (饱和度)也叫纯度：饱和度越低，色彩越白。
			- Value of brightness(亮度)：亮度越低，色彩越黑

	- CIE XYZ色彩空间

		- 由国际发光照明委员会于1931年提出。
		- CIE XYZ色彩空间可以表示所有可感知的色彩（而RGB不能）

			- 色彩基XYZ是色彩基RGB的线性变换。
			- 更多的应用于色彩科学的研究
			- 与人类的感知系统密切相关

### 图像和像素

- 图像

	- 图像可以看成一个二维离散函数：f(x,y)
	- 函数f 的定义域是由矩阵排列着的许多格子组成，这些格子被称为像素（pixel）
	- 函数f的取值则为各个像素的色彩：对于彩色图像，可以是RGB或者RGBA；对于灰度图像，f为单值函数

### 三角网格模型

- 图形学的基本目标是什么？

	- 从虚拟的三维场景即相机的位置信息中，生成出一幅二维图像。
	- 而三维场景又以怎么样的数据结构来表示？

		- 简单的球体，长方体可直接用其参数描述。
		- 对于复杂模型，则寻妖使用参数曲线和曲面或者更一般的网络模型来进行描述。
		- 网络模型中又以三角网格最为常用

- 三角网格的定义

	- 三角网格是由一系列欧式空间中的三维顶点以及连接这些顶点的若干三角面片组成，具体包括：

		- 顶点集合 V=(v1,v2,...,vn)
		- 面片集合 F=(f1,f2,...,fm)

			- 其中F中每个面片fi都是由V中的顶点构成的空间三角形：f1 = (Va1,Vb1,Vc1),f2 = (Va2,Vb2,Vc2)

- 三角网格的法向量

	- 三角面片的法向量是垂直于该面片所在平面的非零向量；
	- 对于每个三角面片单独而言，其法向量都有俩种可能的朝向；
	- 法向量的朝向决定了一个三角面片的正面与反面
	- 对于连续可定向的三角网格整体而言，相邻的三角面片需要具备一致的法向量朝向。

- 顶点法向量的计算

	- 三角网格顶点的方向量可以通过其周围的所有三角面片的法向量通过加权叠加运算：

		- 假设v是k个三角面片f1，f2,...fk所共有的顶点；
		- 按算数平均计算

			- Nv=(Nf1+...+Nfk)/k

		- 按面积加权平均计算：

			- Nv=(Sf1Nf1+...+SfkNfk)/(Sf1+...+Sfk)

		- 按角度加权平均计算：

			- Nv=(Angf1Nf1+...+AngfkNfk)/(Angf1+...+Angfk)

- 三角网格的简单绘制

	- 三角网格模型的每个顶点需要指定一个色彩属性
	- 基于色彩的绘制

		- 模型表面的每点的色彩通过其所在三角面片的顶点色彩插值得到。

	- 基于光照的绘制

		- 需要指定一个虚拟的光照环境
		- 如何计算光照对色彩的影响是最大的问题

### 光照模型

- 光照模型(lighting model或 illumination model) 用于计算光的强度：

	- 局部光照明（Local Lighting）

		- 关注物体直接受到光源影响所产生的光照效果

	- 全局光照明

		- 关注阴影效果
		- 关注所有不是直接与光源位置相关的光照效果，例如反射和折射效果，等等...

- 光照模型的历史

	- 1967年，Wylie等人第一次在显示物体时加入了光照明效果，认为光的强度与物体到光源的距离成反比关系
	- 1970，Bouknight 提出了第一个光反射模型：

		- Lambert 漫反射光+环境光
		- 发表于Communication of ACM

	- 1971， Gouraud提出了漫反射模型加插值的思想：

		- Lambert 漫反射光 + Barycentric插值
		- 发表于 IEEE transactions on Computers

	- 1975, Phong提出了图形学中第一个有影响也是最有影响的光照模型：Phong 模型

		- 漫反射(diffuse light) + 环境光(ambient light) + 高光(specular light)
		- 发表于 Communication of ACM

- 光的传播

	- 光的传播遵循反射定律

		- 入射角等于反射角；
		- 入射光线、反射光线、以及反射面的法向量位于同一平面内。

	- 折射定律（也叫Snell定律）：

		- 入射角和反射角的正弦值之比是一个仅仅取决于介质的常数；
		- 这个常数称为相对折射系数。
		- 光的传播遵循能量守恒定律：

			- Ii = Id+Is+It+Iv

				- Ii:入射光的能量
				- Id:漫反射光的能量
				- Is：镜面反射光的能量
				- It:折射光的能量
				- Iv：被介质和物体所吸收的能量

	- 光的度量方法

		- 立体角（SolidAngle）

			- 衡量物体相对于某一视点P的视角大小：

				- dω=ds/r^2

			- 立体角最大为4π

		- 光通量（Luminous Flux）

			- 光通量定义为：单位时间内通过面元dS的光能量，记为dF

		- 发光强度（Radiance）:

			- 发光强度定义为：单位立体角内的光通量，记为I

- Phong光照模型

	- Phong模型支持点光源和方向光源
	- Phong模型是局部光照模型，将局部光照明效果分解为三个部分：

		- 漫反射光效果

			- 漫反射光的传播是各向同性的；
			- 漫反射光的强度为：

				- Id = IiKd*（L·N）

			- Kd是漫反射系数
			- Kd具有三个分量 kdr，kdg，kdb，分别代表三个通道的满发射系数。
			- Kd与模型自身的色彩紧密相关。

		- 镜面反射光效果

			- 对于光滑的平面，依据反射定律，反射光线往往集中在一个小的立体角内，这些反射光我们称之为镜面反射光
			- 镜面反射光的强度为：Is=IiKs*(R·V)^n
			- Ks是镜面反射系数，与物体表面光滑程度相关；
			- n是反射指数；n越大，则高光区域越集中

		- 环境光效果

			- 环境光的强度为：Ia = IiKa
			- Ka是物体对环境光的反射系数

	- 视角方向的发光强度为漫反射光分量、镜面反射光分量。以及环境光分量的发光强度之和：

		- I = Ii(Ka+Ks*(R·V)^n+Kd*(L·N))

- 明暗处理

	- 考虑到物体表面的几何细节往往并不规则，为了缓解由模型离散化所导致的不光滑的色彩效果，通常的明暗处理除了使用光照模型外。还需要进行插值。
	- Gouraud明暗处理和Phong明暗处理

		- Gouraud明暗处理

			- 由Gouranud于1971年提出

				- 又被称为Gouraud插值

			- 计算方法

				- 首先计算所有模型顶点的色彩值
				- 对模型上的任何一点，按照其所在的三角面片上顶点的色彩值按重心插值（Barycentric Interpolation）的结果赋予其色彩值

		- Phong明暗处理

			- 由BuiTuongPhong于1973年在他的博士论文中提出。

				- 与Phong光照模型是不同的概念

			- 计算方法

				- 与Gouraud明暗处理不同，Phong明暗处理不是对色彩插值，而是对点的法向量进行插值，得到连续的法向量场，再利用该法向量场逐点使用光照模型进行色彩的计算

### 视点变换和视点方向

- 图形学关注于如何将由几何模型组成的三维场景绘制成高质量的彩色图像。
- 变换在图形学中至关重要：通过变换，可以简洁高效地设置和编辑三维场景，光照位置，以及视点方向。
- 什么叫变换？

	- 变换是一个将空间中的点映射成其他点x‘的函数

- 简单变换

	- 不变
	- 平移
	- 旋转
	- 均衡缩放
	- 变换可以相互复合和嵌套
	- 简单变换都是可逆的

- 常见变换

	- 刚体变换

		- 保持度量
		- 不变变换
		- 平移
		- 旋转

	- 相似变换

		- 保持角度
		- 不变
		- 平移
		- 旋转
		- 均匀缩放

	- 线性变换

		- 线性变换满足方程

			- L(p+q)=L(p)+L(q)
			- aL(p)=L(ap)

		- 线性变换包括

			- 不变、旋转、缩放（不一定要均衡缩放）
			- 对称，错切

	- 仿射变换

		- 保持直线以及直线与直线的平行
		- 包括线性变换，相似变换，以及他们的复合

	- 投影变换

## 开创了真实感图形学的历史

*XMind: ZEN - Trial Version*